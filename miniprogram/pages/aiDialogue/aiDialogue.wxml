<!--pages/registerHelper/registerHelper.wxml-->
<view class="ai-dialogue-page">
  <!-- 问诊任务描述区（可展开） -->
  <view class="task-description-bar">
    <view class="task-summary">
      <text class="task-text">
        {{ currentTaskSummary || '点击“+”开始一段新问诊任务' }}
      </text>
      <view class="toggle-task" bindtap="toggleTaskDescription">
        {{ showTaskDetail ? '∧' : '∨' }}
      </view>
    </view>
    <view wx:if="{{showTaskDetail}}" class="task-detail">
      {{ currentTaskDetail || '暂无任务描述。请选择症状开始问诊。' }}
    </view>
  </view>

  <!-- 缴费提示弹窗 -->
  <view class="payment-modal" wx:if="{{showPaymentModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">完成缴费</text>
        <view class="close-btn" bindtap="closePaymentModal">×</view>
      </view>
      <view class="modal-body">
        <text class="payment-content">支付功能正在开发中，点击完成继续。</text>
      </view>
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="onPaymentComplete">完成</button>
      </view>
    </view>
  </view>

  <!-- 对话历史区域 -->
  <scroll-view class="chat-history" scroll-y="true" scroll-with-animation scroll-top="{{scrollTop}}">
    <view wx:for="{{messages}}" wx:key="index" class="message {{item.type}}-message">
      <view class="content">
        <text class="text">{{item.content}}</text>
        <!-- 选项区域 -->
        <view wx:if="{{item.options && item.options.length > 0}}" class="options">
          <view
            wx:for="{{item.options}}"
            wx:for-item="option"
            wx:key="option"
            class="option"
            bindtap="selectOption"
          >
            {{option}}
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 👇 功能按钮栏：放在输入框上方 -->
  <view class="functional-bar-wrapper">
    <view class="functional-bar {{showFunctionalBar ? 'expanded' : 'collapsed'}}">
      <view class="functional-item" bindtap="gotoHistory">历史记录</view>
      <view class="functional-item" bindtap="gotoVoiceInput">语音输入</view>
      <view class="functional-item" bindtap="gotoReport">图文报告</view>
      <view class="functional-item" bindtap="gotoAIExplanation">AI解释</view>
    </view>
    <view class="toggle-functional" bindtap="toggleFunctionalBar">
      {{ showFunctionalBar ? '<' : '>' }}
    </view>
  </view>

  <!-- 用户输入区域 -->
  <view class="input-area">
    <textarea
      class="input-box"
      placeholder="请描述您的症状..."
      value="{{userInput}}"
      bindinput="onInputChange"
      auto-height="{{true}}"
      maxlength="500"
      placeholder-style="color:#999;"
    />
    <button class="send-btn" bindtap="sendMessage">发送</button>
  </view>


  <!-- 右下角圆形按钮 -->
  <view class="floating-plus-btn" bindtap="startNewTask">+</view>
</view>