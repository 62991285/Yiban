<view class="ai-dialogue-page">

  <!-- é—®è¯Šä»»åŠ¡æè¿°åŒºï¼ˆå¯å±•å¼€ï¼‰- ç²˜æ»å®šä½ -->
  <view class="task-description-bar sticky-top">
    <view class="task-summary">
      <view class="task-icon">ğŸ¯</view>
      <text class="task-text">
        {{ currentTaskSummary || 'ç‚¹å‡»â€œ+â€å¼€å§‹ä¸€æ®µæ–°é—®è¯Šä»»åŠ¡' }}
      </text>
      <view class="toggle-task" bindtap="toggleTaskDescription">
        {{ showTaskDetail ? 'âˆ§' : 'âˆ¨' }}
      </view>
    </view>
    <view wx:if="{{showTaskDetail}}" class="task-detail">
      {{ currentTaskDetail || 'æš‚æ— ä»»åŠ¡æè¿°ã€‚è¯·é€‰æ‹©ç—‡çŠ¶å¼€å§‹é—®è¯Šã€‚' }}
    </view>
  </view>

  <!-- å¯¹è¯å†å²åŒºåŸŸ -->
  <scroll-view class="chat-history" scroll-y="true" scroll-with-animation scroll-top="{{scrollTop}}" enhanced="true" bounces="true">
    <view class="chat-container">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-wrapper {{item.speaker === 'ai' ? 'ai-wrapper' : 'user-wrapper'}}">
          <message-item 
            speaker="{{item.speaker === 'ai' ? 'ai' : 'user'}}"
            options="{{item.options || []}}"
            actions="{{item.actions || []}}"
            bindselectoption="selectOption"
            class="animated-message"
          >
            <text>{{item.content}}</text>
          </message-item>
        </view>
      </block>
      
      <!-- AIæ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨ -->
      <view wx:if="{{isAITyping}}" class="typing-indicator">
        <view class="typing-dots">
          <view class="dot dot-1"></view>
          <view class="dot dot-2"></view>
          <view class="dot dot-3"></view>
        </view>
        <text class="typing-text">AIæ­£åœ¨æ€è€ƒ...</text>
      </view>
    </view>
  </scroll-view>

  <!-- èŠå¤©æ“ä½œåŒº - ç²˜æ»å®šä½ -->
  <view class="chat-controls sticky-controls">
    <text class="delete-chat-history" bind:tap="deleteChatHistory"> ğŸ—‘ï¸ æ¸…ç©ºå¯¹è¯</text>
    <view class="chat-stats">
      <text class="message-count">æ¶ˆæ¯ {{messages.length}}</text>
    </view>
    <!-- æµ®åŠ¨æŒ‰é’® - ç²˜æ»æ¨¡å¼ï¼Œä½äºå³ä¸Šè§’ -->
    <view class="sticky-fab-btn {{isAIAssistedMode===true?'mode-delete':'mode-add'}}" bindtap="startOrDeleteNewTask">
      <text class="fab-icon-new">{{isAIAssistedMode===true?'âˆ’':'+'}}</text>
      <view class="fab-tooltip-new">{{isAIAssistedMode===true?'ç»“æŸé—®è¯Š':'æ–°å»ºé—®è¯Š'}}</view>
    </view>
  </view>

  <!-- æ»‘åŠ¨å¼åŠŸèƒ½æŒ‰é’®æ  - ç²˜æ»å®šä½ -->
  <view class="scroll-functional-bar sticky-functional-bar">
    <scroll-view class="functional-scroll-view" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="functional-list">
        <view class="functional-item" bindtap="gotoHistory">
          <text class="func-icon">ğŸ“</text>
          <text class="func-text">é™¢å†…å¯¼èˆª</text>
        </view>
        <view class="functional-item" bindtap="gotoVoiceInput">
          <text class="func-icon">ğŸ“</text>
          <text class="func-text">æŒ‚å·æœåŠ¡</text>
        </view>
        <view class="functional-item" bindtap="gotoReport">
          <text class="func-icon">ğŸ“‹</text>
          <text class="func-text">æ£€æŸ¥é¢„çº¦</text>
        </view>
        <view class="functional-item" bindtap="gotoAIExplanation">
          <text class="func-icon">âš•ï¸</text>
          <text class="func-text">æ²»ç–—é¢„çº¦</text>
        </view>
        <view class="functional-item" bindtap="gotoHistory">
          <text class="func-icon">ğŸ¥</text>
          <text class="func-text">ç§‘å®¤ä»‹ç»</text>
        </view>
        <view class="functional-item" bindtap="gotoVoiceInput">
          <text class="func-icon">ğŸ’Š</text>
          <text class="func-text">è¯å“æŸ¥è¯¢</text>
        </view>
        <view class="functional-item" bindtap="gotoReport">
          <text class="func-icon">ğŸ©º</text>
          <text class="func-text">ä½“æ£€å¥—é¤</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç”¨æˆ·è¾“å…¥åŒºåŸŸ - AIé£æ ¼ - ç²˜æ»å®šä½ -->
  <view class="ai-input-container sticky-input">
    <view class="input-wrapper-modern">
      <textarea
        class="modern-input-box"
        placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„ç—‡çŠ¶ï¼ŒAIå°†ä¸ºæ‚¨æä¾›ä¸“ä¸šå»ºè®®..."
        value="{{userInput}}"
        bindinput="onInputChange"
        auto-height="{{true}}"
        maxlength="500"
        placeholder-style="color:#999;"
        show-confirm-bar="false"
      />
      <button class="modern-send-btn {{userInput.trim()==='' ? '' : 'send-btn-active'}}" bindtap="sendMessage" disabled="{{userInput.trim() === ''}}">
        <text class="send-text-modern">å‘é€</text>
      </button>
    </view>
    <view class="outside-char-count">
      <text class="char-count-modern">{{userInput.length}}/500</text>
    </view>
  </view>


</view>