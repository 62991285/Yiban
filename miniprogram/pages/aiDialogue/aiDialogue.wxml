<view class="ai-dialogue-page">
  <!--  é—®è¯Šä»»åŠ¡æè¿°åŒºï¼ˆå¯å±•å¼€ï¼‰ -->
  <view class="task-description-bar">
    <view class="task-summary">
      <text class="task-text">
        {{ currentTaskSummary || 'ç‚¹å‡»â€œ+â€å¼€å§‹ä¸€æ®µæ–°é—®è¯Šä»»åŠ¡' }}
      </text>
      <view class="toggle-task" bindtap="toggleTaskDescription">
        {{ showTaskDetail ? 'âˆ§' : 'âˆ¨' }}
      </view>
    </view>
    <view wx:if="{{showTaskDetail}}" class="task-detail">
      {{ currentTaskDetail || 'æš‚æ— ä»»åŠ¡æè¿°ã€‚è¯·é€‰æ‹©ç—‡çŠ¶å¼€å§‹é—®è¯Šã€‚' }}
    </view>
  </view>

  <!-- ç¼´è´¹æç¤ºå¼¹çª— -->
  <view class="payment-modal" wx:if="{{showPaymentModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">å®Œæˆç¼´è´¹</text>
        <view class="close-btn" bindtap="closePaymentModal">Ã—</view>
      </view>
      <view class="modal-body">
        <text class="payment-content">æ”¯ä»˜åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œç‚¹å‡»å®Œæˆç»§ç»­ã€‚</text>
      </view>
      <view class="modal-footer">
        <button class="btn btn-confirm" bindtap="onPaymentComplete">å®Œæˆ</button>
      </view>
    </view>
  </view>

  <!-- å¯¹è¯å†å²åŒºåŸŸ -->
  <scroll-view class="chat-history" scroll-y="true" scroll-with-animation scroll-top="{{scrollTop}}">
  <block wx:for="{{messages}}" wx:key="index">
    <message-item 
      speaker="{{item.speaker === 'ai' ? 'ai' : 'user'}}"
      options="{{item.options || []}}"
      actions="{{item.actions || []}}"
      bindselectoption="selectOption"
    >
      <text>{{item.content}}</text>
    </message-item>

  </block>
</scroll-view>

<text class="delete-chat-history" bind:tap="deleteChatHistory"> åˆ é™¤èŠå¤©å†å²</text>
  <!-- ğŸ‘‡ åŠŸèƒ½æŒ‰é’®æ ï¼šæ”¾åœ¨è¾“å…¥æ¡†ä¸Šæ–¹ -->
  <view class="functional-bar-wrapper">
    <view class="functional-bar {{showFunctionalBar ? 'expanded' : 'collapsed'}}">
      <view class="functional-item" bindtap="gotoHistory">é™¢å†…å¯¼èˆª</view>
      <view class="functional-item" bindtap="gotoVoiceInput">æŒ‚å·æœåŠ¡</view>
      <view class="functional-item" bindtap="gotoReport">æ£€æŸ¥é¢„çº¦</view>
      <view class="functional-item" bindtap="gotoAIExplanation">æ²»ç–—é¢„çº¦</view>
    </view>
    <view class="toggle-functional" bindtap="toggleFunctionalBar">
      {{ showFunctionalBar ? '<' : '>' }}
    </view>
  </view>

  <!-- ç”¨æˆ·è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <textarea
      class="input-box"
      placeholder="è¯·æè¿°æ‚¨çš„ç—‡çŠ¶..."
      value="{{userInput}}"
      bindinput="onInputChange"
      auto-height="{{true}}"
      maxlength="500"
      placeholder-style="color:#999;"
    />
    <button class="send-btn" bindtap="sendMessage">å‘é€</button>
  </view>


  <!-- å³ä¸‹è§’åœ†å½¢æŒ‰é’® -->
  <view class="floating-plus-btn" bindtap="startOrDeleteNewTask">{{isAIAssistedMode===true?"-":"+"}}</view>
</view>